/* 
 * leaflet.datalayer v0.0.3 | License: MIT 
 */
!function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b(require("L")):"function"==typeof define&&define.amd?define(["L"],b):"object"==typeof exports?exports["leaflet.datalayer"]=b(require("L")):a["leaflet.datalayer"]=b(a.L)}(this,function(a){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){var d=c(1),e=c(2);e.IDataProvider=c(3),e.IDataRenderer=c(4),e.SimpleDataProvider=c(5),e.MarkersRenderer=c(6),e.IndexedCanvas=c(7),e.P=e.Promise=d.Promise=c(8),e.DataUtils=c(9),a.exports=d.DataLayer=e},function(b){b.exports=a},function(a,b,c){var d=c(1),e=c(5),f=c(6),g=(c(7),c(8)),h=d.TileLayer.Canvas.extend({options:{resolution:4,pointerCursor:!0,async:!0,reuseTiles:!1,reuseMasks:!0},initialize:function(a){a.fillOpacity=a.opacity,delete a.opacity;var b=null;d.TileLayer.Canvas.prototype.initialize.apply(this,b,a),d.setOptions(this,a),this.options.data&&this.setData(this.options.data)},onAdd:function(a){this._map=a;var b=this._getDataRenderer();b.onAdd(this),d.TileLayer.Canvas.prototype.onAdd.apply(this,arguments),this.on("tileunload",this._onTileUnload,this),this._initEvents("on"),this.redraw()},onRemove:function(){this.off("tileunload",this._onTileUnload,this),this._initEvents("off"),this._removeMouseCursorStyle(),d.TileLayer.Canvas.prototype.onRemove.apply(this,arguments);var a=this._getDataRenderer();a.onRemove(this)},_initContainer:function(){var a=d.TileLayer.Canvas.prototype._initContainer;a.apply(this,arguments);var b=this._getDataLayersPane();b.appendChild(this._container)},_getDataLayersPane:function(){return this._map._panes.markerPane},_initEvents:function(){var a="click mouseover mouseout mousemove";this._map.on(a,function(a){"click"===a.type?this._click(a):this._move(a)},this)},_click:function(a){var b=!1;if(this.hasEventListeners("click")){var c=this._objectForEvent(a);c.data&&(this.fire("click",c),b=!0)}return b},_move:function(a){var b=!1,c=this._objectForEvent(a);if(c.data!==this._mouseOn){if(this._mouseOn){if(this.hasEventListeners("mouseout")){var d=c.data;c.data=this._mouseOn,this.fire("mouseout",c),c.data=d,b=!0}this._removeMouseCursorStyle()}c.data&&(this.hasEventListeners("mouseover")&&(this.fire("mouseover",c),b=!0),this._setMouseCursorStyle()),this._mouseOn=c.data}else c.data&&this.hasEventListeners("mousemove")&&(this.fire("mousemove",c),b=!0);return b},_setMouseCursorStyle:function(){if(this.options.pointerCursor){var a=this._getMapContainer();a._pointerCursorCount?a._pointerCursorCount++:(a._pointerCursorCount=1,a.style.cursor="pointer")}},_removeMouseCursorStyle:function(){if(this.options.pointerCursor){var a=this._getMapContainer();a._pointerCursorCount&&(a._pointerCursorCount--,0===a._pointerCursorCount&&(a.style.cursor="",delete a._pointerCursorCount))}},_getMapContainer:function(){return this._map._container},_getDataProvider:function(){return this.options.dataProvider||(this.options.dataProvider=new e),this.options.dataProvider},setData:function(a){var b=this._getDataProvider();b.setData&&(b.setData(a),this._map&&this.redraw())},_onTileUnload:function(a){var b=a.tile;b._index&&(b._index.reset(),delete b._index)},_redrawTile:function(a){var b=this,c=a._tilePoint,d=this._getTileBoundingBox(c),e=this._getDataProvider(),f=b._getDataRenderer();return g.then(function(){return e.loadData({tilePoint:c,bbox:d})}).then(function(d){var e=b.getTileSize(),g=b._map.getZoom();return f.renderData({tilePoint:[c.x,c.y],tileSize:e,zoom:g,canvas:a,data:d,map:b._map})}).then(function(c){a._index=c,b.tileDrawn(a)},function(d){try{b._handleRenderError(a,c,d)}finally{b.tileDrawn(a)}})},_handleRenderError:function(a,b,c){console.log("ERROR",c)},_getDataRenderer:function(){return this.options.dataRenderer||(this.options.dataRenderer=new f({map:this._map,layer:this})),this.options.dataRenderer},_objectForEvent:function(a){var b=a.latlng,c=this._map,d=c.latLngToLayerPoint(b);d=d.add(c.getPixelOrigin());var e,f=this._getTileSize(),g=d.divideBy(f).floor(),h=g.x+":"+g.y,i=this._tiles[h];if(i){var j=i._index;if(j){var k=d.x%f,l=d.y%f;e=j.getData(k,l)}}return a.data=e,a}});a.exports=h},function(a,b,c){var d=c(8),e=(c(9),{loadData:function(){return d.resolve([])}});a.exports=e},function(a,b,c){var d=c(1),e=c(8),f=c(7),g=c(9),h=d.Class.extend({initialize:function(a){this.options=a||{}},renderData:function(a){var b=this,c=b._newCanvasContext(a);return e.then(function(){return b._prepareContext(c)}).then(function(){var d=a.data||[];g.forEach(d,function(a){b._drawFeature(a,c)})}).then(function(){return c})},getBufferZoneSize:function(){return[0,0]},_prepareContext:function(){return e.resolve()},_drawFeature:function(){},_newCanvasContext:function(a){a=g.extend({},a,{maskIndex:this.options.maskIndex||{}});var b=new f(a);return b},onAdd:function(a){this._layer=a,this._map=a._map},onRemove:function(){delete this._layer,delete this._map}});a.exports=h},function(a,b,c){var d=c(1),e=c(10),f=(c(3),c(9)),g=c(8),h=d.Class.extend({initialize:function(a){this.options=a||{},this.setData(this.options.data)},setData:function(a){this._indexData(a)},loadData:function(a){var b=this,c=b._searchInBbox(a.bbox);return g.resolve(c)},_indexData:function(a){this._rtree=e(9),a=a||[];var b=[],c=this;f.forEach(a,function(a){var d=c._getBoundingBox(a);if(d){var e=c._toIndexKey(d);e.data=a,b.push(e)}}),this._rtree.load(b)},_searchInBbox:function(a,b){var c=this._toIndexKey(a),d=b?[b.lat,b.lng]:[c[0],c[1]],e=this._rtree.search(c);e.sort(function(a,b){var c=Math.abs(a[0]-d[0])+Math.abs(a[1]-d[1]),e=Math.abs(b[0]-d[0])+Math.abs(b[1]-d[1]);return c-e});var g=[];return f.forEach(e,function(a){g.push(a.data)}),g},_toIndexKey:function(a){var b=a[0],c=a[1],d=[b[0],b[1],c[0],c[1]];return d},_getBoundingBox:f.getGeoJsonBoundingBox});a.exports=h},function(a,b,c){function d(a){this.initialize(a)}var e=c(1),f=c(4),g=c(9),d=(c(8),f.extend({initialize:function(){f.prototype.initialize.apply(this,arguments),this._markerCache={}},getBufferZoneSize:function(){var a=2.5*this._getRadius();return[a,a]},_drawFeature:function(a,b){var c=(b.options.tilePoint,this._getPositionOnTile(a,b));if(c){var d,e=that._getMarkerCacheKey(a,b);if(e&&(d=this._markerCache[e]),d||(d=this._newResourceMarker(a,b),d&&d.image&&e&&(this._markerCache[e]=d)),d&&d.image){var f=c[0],g=c[1];d.anchor&&(f-=d.anchor[0],g-=d.anchor[1]),b.draw(d.image,f,g,a)}}},_getPositionOnTile:function(a){var b=this._getCoordinates(a);if(b){var c=this._map,d=this._layer,f=d.getTileSize(),g=(e.latLng(b),c.project(latlng)),h=tilePoint.multiplyBy(f),i=Math.round(g.x-h.x),j=Math.round(g.y-h.y);return[i,j]}},_getCoordinates:function(a){var b=g.getGeoJsonBoundingBox(a);if(!b)return null;var c=(b[0][0]+b[1][0])/2,d=(b[0][1]+b[1][1])/2;return e.latLng(c,d)},_getRadius:function(){return this.options.radius||16},_getMarkerCacheKey:function(a,b){var c=b.options.zoom,d=this._getResourceType(a),e=c+":"+d;return e},_getResourceType:function(){return"resource"},_newResourceMarker:function(){var a=this._getRadius(),b=document.createElement("canvas"),c=this._getVal("lineWidth",1),d=2*a,e=2*a;b.height=e,b.width=d,a-=c;var f=b.getContext("2d");return f.fillStyle=this._getVal("fillColor","white"),f.globalAlpha=this._getVal("fillOpacity",1),f.strokeStyle=this._getVal("lineColor","gray"),f.lineWidth=c,f.lineCap="round",this._drawMarker(f,c,c,d-2*c,e-2*c,.6*a),f.fill(),f.stroke(),{image:b,anchor:[d/2,e]}},_drawMarker:function(a,b,c,d,e,f){a.beginPath(),a.moveTo(b+d/2,c),a.bezierCurveTo(b+d/2+f/2,c,b+d/2+f,c+f/2,b+d/2+f,c+f),a.bezierCurveTo(b+d/2+f,c+2*f,b+d/2,c+e/2+f/3,b+d/2,c+e),a.bezierCurveTo(b+d/2,c+e/2+f/3,b+d/2-f,c+2*f,b+d/2-f,c+f),a.bezierCurveTo(b+d/2-f,c+f/2,b+d/2-f/2,c+0,b+d/2,c+0),a.closePath()}}));a.exports=d},function(a){function b(a){this.initialize(a)}b.prototype={initialize:function(a){this.options=a||{};var b=this.options.resolution||4;this.options.resolutionX=this.options.resolutionX||b,this.options.resolutionY=this.options.resolutionY||this.options.resolutionX||b,this._canvas=this.options.canvas,this._maskWidth=this._getMaskX(this._canvas.width),this._maskHeight=this._getMaskY(this._canvas.height),this._dataIndex={}},draw:function(a,b,c,d){var e=this._canvas.getContext("2d");e.drawImage(a,b,c),this._addToCanvasMask(a,b,c,d)},getData:function(a,b){var c=this._getMaskX(a),d=this._getMaskY(b),e=d*this._maskWidth+c,f=this._dataIndex[e];return f},reset:function(){this._dataIndex={},this._maskIndex&&(this._maskIndex={});var a=this._canvas.getContext("2d");a.clearRect(0,0,this._canvas.width,this._canvas.height)},_addToCanvasMask:function(a,b,c,d){for(var e=this._getImageMask(a),f=this._getMaskX(a.width),g=this._getMaskX(b),h=this._getMaskY(c),i=0;i<e.length;i++)if(e[i]){var j=g+i%f,k=h+Math.floor(i/f);j>=0&&j<this._maskWidth&&k>=0&&k<this._maskHeight&&(this._dataIndex[k*this._maskWidth+j]=d)}},_getImageMask:function(a){var b=this._getImageMaskIndex(),c=this._getImageKey(a),d=b[c];return d||(d=this._buildImageMask(a),b[c]=d),d},_getImageKey:function(a){return a._imageId||(b._id_counter=(b._id_counter||0)+1,a._imageId="image-"+b._id_counter),a._imageId},_getImageMaskIndex:function(){return this.options.maskIndex?this.options.maskIndex:(this._maskIndex=this._maskIndex||{},this._maskIndex)},_buildImageMask:function(a){var b=this._newCanvas(),c=b.getContext("2d");b.width=a.width,b.height=a.height,c.drawImage(a,0,0);for(var d=c.getImageData(0,0,a.width,a.height).data,e=this._getMaskX(a.width),f=(this._getMaskY(a.height),new Array(a.width*a.height)),g=0;g<a.height;g++)for(var h=0;h<a.width;h++){var i=4*(g*a.width+h)+3,j=this._getMaskX(h),k=this._getMaskY(g);f[k*e+j]=d[i]?1:0}return f},_newCanvas:function(){return document.createElement("canvas")},_getMaskX:function(a){var b=this.options.resolutionX;return Math.round(a/b)},_getMaskY:function(a){var b=this.options.resolutionY;return Math.round(a/b)}},a.exports=b},function(a,b,c){function d(a){return d.resolve(a)}a.exports=d,d.defer=function(){var a=c(11);return d.defer=a.defer,d.defer()},d.then=function(a,b){var c=d.defer();return c.resolve(),c.promise.then(a,b)},d.reject=function(a){var b=d.defer();return b.reject(a),b.promise},d.resolve=function(a){var b=d.defer();return b.resolve(a),b.promise},d.isPromise=function(a){return a&&"function"==typeof a.then},d._isArray=function(a){return d._isArray=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},d._isArray(a)},d.all=function(a){function b(a,b){h.push(b),a?f.reject(a):h.length===g&&f.resolve(h)}function c(a){b(null,a)}function e(a){b(a,null)}var f=d.defer();a=d._isArray(a)?a:arguments;for(var g=a?a.length:0,h=[],i=0;g>i;i++)a[i].then(c,e);return 0===g&&f.resolve(h),f.promise},d.nresolver=function(a){return function(b,c){b?a.reject(b):a.resolve(c)}},d.ninvoke=function(a,b){for(var c=[],e=2;e<arguments.length;e++)c.push(arguments[e]);var f=d.defer();c.push(d.nresolver(f));try{var g="function"==typeof b?b:a[b];g.apply(a,c)}catch(h){f.reject(h)}return f.promise}},function(a,b,c){var d=c(1);a.exports={forEach:function(a,b){if(a.forEach)a.forEach(b);else for(var c=a?a.length:0,d=0;c>d;d++)b(a[d],d)},extend:function(){var a=arguments[0];if(a)for(var b=1;b<arguments.length;b++){var c=arguments[b];if(c)for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])}return a},getGeoJsonBoundingBox:function(a){if(!a)return null;var b=a.geometry;if(!b||!b.coordinates)return null;var c;if("Point"==b.type){var e=b.coordinates,f=d.latLng(e[1],e[0]);c=d.latLngBounds(f,f)}else{var g=d.GeoJSON.geometryToLayer(b);c=g.getBounds()}return[[c.getSouth(),c.getWest()],[c.getNorth(),c.getEast()]]}}},function(a,b,c){var d;!function(){"use strict";function e(a,b){return this instanceof e?(this._maxEntries=Math.max(4,a||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),b&&this._initFormat(b),void this.clear()):new e(a,b)}function f(a,b){a.bbox=g(a,0,a.children.length,b)}function g(a,b,c,d){for(var e,f=h(),g=b;c>g;g++)e=a.children[g],i(f,a.leaf?d(e):e.bbox);return f}function h(){return[1/0,1/0,-1/0,-1/0]}function i(a,b){return a[0]=Math.min(a[0],b[0]),a[1]=Math.min(a[1],b[1]),a[2]=Math.max(a[2],b[2]),a[3]=Math.max(a[3],b[3]),a}function j(a,b){return a.bbox[0]-b.bbox[0]}function k(a,b){return a.bbox[1]-b.bbox[1]}function l(a){return(a[2]-a[0])*(a[3]-a[1])}function m(a){return a[2]-a[0]+(a[3]-a[1])}function n(a,b){return(Math.max(b[2],a[2])-Math.min(b[0],a[0]))*(Math.max(b[3],a[3])-Math.min(b[1],a[1]))}function o(a,b){var c=Math.max(a[0],b[0]),d=Math.max(a[1],b[1]),e=Math.min(a[2],b[2]),f=Math.min(a[3],b[3]);return Math.max(0,e-c)*Math.max(0,f-d)}function p(a,b){return a[0]<=b[0]&&a[1]<=b[1]&&b[2]<=a[2]&&b[3]<=a[3]}function q(a,b){return b[0]<=a[2]&&b[1]<=a[3]&&b[2]>=a[0]&&b[3]>=a[1]}function r(a,b,c,d,e){for(var f,g=[b,c];g.length;)c=g.pop(),b=g.pop(),d>=c-b||(f=b+Math.ceil((c-b)/d/2)*d,s(a,b,c,f,e),g.push(b,f,f,c))}function s(a,b,c,d,e){for(var f,g,h,i,j,k,l,m,n;c>b;){for(c-b>600&&(f=c-b+1,g=d-b+1,h=Math.log(f),i=.5*Math.exp(2*h/3),j=.5*Math.sqrt(h*i*(f-i)/f)*(0>g-f/2?-1:1),k=Math.max(b,Math.floor(d-g*i/f+j)),l=Math.min(c,Math.floor(d+(f-g)*i/f+j)),s(a,k,l,d,e)),m=a[d],g=b,n=c,t(a,b,d),e(a[c],m)>0&&t(a,b,c);n>g;){for(t(a,g,n),g++,n--;e(a[g],m)<0;)g++;for(;e(a[n],m)>0;)n--}0===e(a[b],m)?t(a,b,n):(n++,t(a,n,c)),d>=n&&(b=n+1),n>=d&&(c=n-1)}}function t(a,b,c){var d=a[b];a[b]=a[c],a[c]=d}e.prototype={all:function(){return this._all(this.data,[])},search:function(a){var b=this.data,c=[],d=this.toBBox;if(!q(a,b.bbox))return c;for(var e,f,g,h,i=[];b;){for(e=0,f=b.children.length;f>e;e++)g=b.children[e],h=b.leaf?d(g):g.bbox,q(a,h)&&(b.leaf?c.push(g):p(a,h)?this._all(g,c):i.push(g));b=i.pop()}return c},load:function(a){if(!a||!a.length)return this;if(a.length<this._minEntries){for(var b=0,c=a.length;c>b;b++)this.insert(a[b]);return this}var d=this._build(a.slice(),0,a.length-1,0);if(this.data.children.length)if(this.data.height===d.height)this._splitRoot(this.data,d);else{if(this.data.height<d.height){var e=this.data;this.data=d,d=e}this._insert(d,this.data.height-d.height-1,!0)}else this.data=d;return this},insert:function(a){return a&&this._insert(a,this.data.height-1),this},clear:function(){return this.data={children:[],height:1,bbox:h(),leaf:!0},this},remove:function(a){if(!a)return this;for(var b,c,d,e,f=this.data,g=this.toBBox(a),h=[],i=[];f||h.length;){if(f||(f=h.pop(),c=h[h.length-1],b=i.pop(),e=!0),f.leaf&&(d=f.children.indexOf(a),-1!==d))return f.children.splice(d,1),h.push(f),this._condense(h),this;e||f.leaf||!p(f.bbox,g)?c?(b++,f=c.children[b],e=!1):f=null:(h.push(f),i.push(b),b=0,c=f,f=f.children[0])}return this},toBBox:function(a){return a},compareMinX:function(a,b){return a[0]-b[0]},compareMinY:function(a,b){return a[1]-b[1]},toJSON:function(){return this.data},fromJSON:function(a){return this.data=a,this},_all:function(a,b){for(var c=[];a;)a.leaf?b.push.apply(b,a.children):c.push.apply(c,a.children),a=c.pop();return b},_build:function(a,b,c,d){var e,g=c-b+1,h=this._maxEntries;if(h>=g)return e={children:a.slice(b,c+1),height:1,bbox:null,leaf:!0},f(e,this.toBBox),e;d||(d=Math.ceil(Math.log(g)/Math.log(h)),h=Math.ceil(g/Math.pow(h,d-1))),e={children:[],height:d,bbox:null};var i,j,k,l,m=Math.ceil(g/h),n=m*Math.ceil(Math.sqrt(h));for(r(a,b,c,n,this.compareMinX),i=b;c>=i;i+=n)for(k=Math.min(i+n-1,c),r(a,i,k,m,this.compareMinY),j=i;k>=j;j+=m)l=Math.min(j+m-1,k),e.children.push(this._build(a,j,l,d-1));return f(e,this.toBBox),e},_chooseSubtree:function(a,b,c,d){for(var e,f,g,h,i,j,k,m;;){if(d.push(b),b.leaf||d.length-1===c)break;for(k=m=1/0,e=0,f=b.children.length;f>e;e++)g=b.children[e],i=l(g.bbox),j=n(a,g.bbox)-i,m>j?(m=j,k=k>i?i:k,h=g):j===m&&k>i&&(k=i,h=g);b=h}return b},_insert:function(a,b,c){var d=this.toBBox,e=c?a.bbox:d(a),f=[],g=this._chooseSubtree(e,this.data,b,f);for(g.children.push(a),i(g.bbox,e);b>=0&&f[b].children.length>this._maxEntries;)this._split(f,b),b--;this._adjustParentBBoxes(e,f,b)},_split:function(a,b){var c=a[b],d=c.children.length,e=this._minEntries;this._chooseSplitAxis(c,e,d);var g={children:c.children.splice(this._chooseSplitIndex(c,e,d)),height:c.height};c.leaf&&(g.leaf=!0),f(c,this.toBBox),f(g,this.toBBox),b?a[b-1].children.push(g):this._splitRoot(c,g)},_splitRoot:function(a,b){this.data={children:[a,b],height:a.height+1},f(this.data,this.toBBox)},_chooseSplitIndex:function(a,b,c){var d,e,f,h,i,j,k,m;for(j=k=1/0,d=b;c-b>=d;d++)e=g(a,0,d,this.toBBox),f=g(a,d,c,this.toBBox),h=o(e,f),i=l(e)+l(f),j>h?(j=h,m=d,k=k>i?i:k):h===j&&k>i&&(k=i,m=d);return m},_chooseSplitAxis:function(a,b,c){var d=a.leaf?this.compareMinX:j,e=a.leaf?this.compareMinY:k,f=this._allDistMargin(a,b,c,d),g=this._allDistMargin(a,b,c,e);g>f&&a.children.sort(d)},_allDistMargin:function(a,b,c,d){a.children.sort(d);var e,f,h=this.toBBox,j=g(a,0,b,h),k=g(a,c-b,c,h),l=m(j)+m(k);for(e=b;c-b>e;e++)f=a.children[e],i(j,a.leaf?h(f):f.bbox),l+=m(j);for(e=c-b-1;e>=b;e--)f=a.children[e],i(k,a.leaf?h(f):f.bbox),l+=m(k);return l},_adjustParentBBoxes:function(a,b,c){for(var d=c;d>=0;d--)i(b[d].bbox,a)},_condense:function(a){for(var b,c=a.length-1;c>=0;c--)0===a[c].children.length?c>0?(b=a[c-1].children,b.splice(b.indexOf(a[c]),1)):this.clear():f(a[c],this.toBBox)},_initFormat:function(a){var b=["return a"," - b",";"];this.compareMinX=new Function("a","b",b.join(a[0])),this.compareMinY=new Function("a","b",b.join(a[1])),this.toBBox=new Function("a","return [a"+a.join(", a")+"];")}},d=function(){return e}.call(b,c,b,a),!(void 0!==d&&(a.exports=d))}()},function(a,b,c){var d,e;!function(f,g){d=g,e="function"==typeof d?d.call(b,c,b,a):d,!(void 0!==e&&(a.exports=e))}(this,function(){"use strict";var a={},b=function(){var a=!1;return function(b){return function(){a||(a=!0,b.apply(null,arguments))}}},c=function(a){var b=a&&a.then;return"object"==typeof a&&"function"==typeof b?function(){return b.apply(a,arguments)}:void 0},d=function(b,c){var d=a.defer(),e=function(a,b){setTimeout(function(){var c;try{c=a(b)}catch(e){return void d.reject(e)}c===d.promise?d.reject(new TypeError("Cannot resolve promise with itself")):d.resolve(c)},1)},g=function(a){b&&b.call?e(b,a):d.resolve(a)},h=function(a){c&&c.call?e(c,a):d.reject(a)};return{promise:d.promise,handle:function(a,b){a===f?g(b):h(b)}}},e=0,f=1,g=2;return a.defer=function(){var a,h=e,i=[],j=function(b,c){h=b,a=c,i.forEach(function(b){b.handle(h,a)}),i=null},k=function(a){j(f,a)},l=function(a){j(g,a)},m=function(b,c){var f=d(b,c);return h===e?i.push(f):f.handle(h,a),f.promise},n=function(a){var c=b();try{a(c(o),c(l))}catch(d){c(l)(d)}},o=function(a){var b;try{b=c(a)}catch(d){return void l(d)}b?n(b):k(a)},p=b();return{resolve:p(o),reject:p(l),promise:{then:m,fail:function(a){return m(null,a)}}}},a})}])});