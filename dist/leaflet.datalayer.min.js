/* 
 * leaflet.datalayer v0.0.5 | License: MIT 
 */
!function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b(require("leaflet")):"function"==typeof define&&define.amd?define(["leaflet"],b):"object"==typeof exports?exports["leaflet.datalayer"]=b(require("leaflet")):a["leaflet.datalayer"]=b(a.leaflet)}(this,function(a){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){var d=c(1),e=c(2);e.IDataProvider=c(3),e.IDataRenderer=c(4),e.SimpleDataProvider=c(5),e.MarkersRenderer=c(6),e.GeometryRenderer=c(7),e.CanvasContext=c(8),e.P=e.Promise=d.Promise=c(9),e.DataUtils=c(10),a.exports=d.DataLayer=e},function(b){b.exports=a},function(a,b,c){var d=c(1),e=c(5),f=c(6),g=c(9),h=d.GridLayer.extend({options:{resolution:4,pointerCursor:!0,reuseMasks:!0},initialize:function(a){a.fillOpacity=a.opacity,delete a.opacity;var b=null;d.GridLayer.prototype.initialize.apply(this,b,a),d.setOptions(this,a),this.options.data&&this.setData(this.options.data)},onAdd:function(){var a=this.getDataRenderer();a.onAdd(this),d.GridLayer.prototype.onAdd.apply(this,arguments),this.on("tileunload",this._onTileUnload,this),this._initEvents("on")},onRemove:function(){this.off("tileunload",this._onTileUnload,this),this._initEvents("off"),this._removeMouseCursorStyle(),d.GridLayer.prototype.onRemove.apply(this,arguments);var a=this.getDataRenderer();a.onRemove(this)},createTile:function(a,b){var c=d.DomUtil.create("canvas","leaflet-tile"),e=this._getTileSize();return c.width=e,c.height=e,c.onselectstart=c.onmousemove=d.Util.falseFn,this._redrawTile(c,a,b),c},_initContainer:function(){var a=d.GridLayer.prototype._initContainer;a.apply(this,arguments);var b=this._getDataLayersPane();b.appendChild(this._container)},_getDataLayersPane:function(){return this.getPane("overlayPane")},_initEvents:function(a){var b="click mouseover mouseout mousemove";this._map[a](b,this._mouseHandler,this)},_mouseHandler:function(a){return"click"===a.type?this._click(a):this._move(a)},_click:function(a){var b=!1;if(this.hasEventListeners("click")){var c=this._objectForEvent(a);c.data&&(this.fire("click",c),b=!0)}return b},_move:function(a){var b=!1,c=this._objectForEvent(a);if(c.data!==this._mouseOn){if(this._mouseOn){if(this.hasEventListeners("mouseout")){var d=c.data;c.data=this._mouseOn,this.fire("mouseout",c),c.data=d,b=!0}this._removeMouseCursorStyle()}c.data&&(this.hasEventListeners("mouseover")&&(this.fire("mouseover",c),b=!0),this._setMouseCursorStyle()),this._mouseOn=c.data}else c.data&&this.hasEventListeners("mousemove")&&(this.fire("mousemove",c),b=!0);return b},_setMouseCursorStyle:function(){if(this.options.pointerCursor){var a=this._getMapContainer();a._pointerCursorCount?a._pointerCursorCount++:(a._pointerCursorCount=1,a.style.cursor="pointer")}},_removeMouseCursorStyle:function(){if(this.options.pointerCursor){var a=this._getMapContainer();a._pointerCursorCount&&(a._pointerCursorCount--,0===a._pointerCursorCount&&(a.style.cursor="",delete a._pointerCursorCount))}},_getMapContainer:function(){return this._map._container},getDataProvider:function(){return this.options.dataProvider||(this.options.dataProvider=new e),this.options.dataProvider},setData:function(a){var b=this.getDataProvider();b.setData&&(b.setData(a),this._map&&this.redraw())},_onTileUnload:function(a){var b=a.tile;b._index&&(b._index.reset(),delete b._index)},_redrawTile:function(a,b,c){var d=this;if(d._map){var e=d.getDataProvider(),f=d.getDataRenderer();return g.then(function(){var a=f.getBufferZoneSize(),c=d._getTileBoundingBox(b,a);return e.loadData({tilePoint:b,bbox:c})}).then(function(c){var e=d._map.getZoom(),g=d._getTileBoundingBox(b);return f.renderData({tilePoint:b,bbox:g,zoom:e,canvas:a,data:c,map:d._map})}).then(function(b){a._index=b,c(null,a)},function(b){c(b,a)})}},getDataRenderer:function(){return this.options.dataRenderer||(this.options.dataRenderer=new f({map:this._map,layer:this})),this.options.dataRenderer},_getTileBoundingBox:function(a,b){var c=this,e=c._getTileSize(),f=a.multiplyBy(e),g=f.add(new d.Point(e,e));b=d.point(b||[0,0]),f=f.subtract(b),g=g.add(b);var h=c._map.unproject(f),i=c._map.unproject(g),j=new d.LatLngBounds(i,h);return j},_objectForEvent:function(a){var b=a.latlng,c=this._map,d=c.latLngToLayerPoint(b);d=d.add(c.getPixelOrigin());var e,f=this._getTileSize(),g=d.divideBy(f).floor(),h=g.x+":"+g.y,i=this._tiles[h];if(i){var j=i._index;if(j){var k=d.x%f,l=d.y%f;e=j.getData(k,l)}}return a.data=e,a}});a.exports=h},function(a,b,c){var d=c(9),e=(c(10),L.Class.extend({loadData:function(){return d.resolve([])}}));a.exports=e},function(a,b,c){var d=c(1),e=c(9),f=c(8),g=c(10),h=d.Class.extend({initialize:function(a){d.setOptions(this,a)},renderData:function(a){var b=this,c=b._newCanvasContext(a);return e.then(function(){return b._prepareContext(c)}).then(function(){for(var d=a.data||[],e=d.length,f=0;e>f;f++){var g=d[f];b._drawFeature(g,c)}}).then(function(){return c})},getBufferZoneSize:function(){return[0,0]},_prepareContext:function(){return e.resolve()},_drawFeature:function(){},_newCanvasContext:function(a){a=g.extend({},a,{maskIndex:this._getMaskIndex()});var b=new f(a);return b},_getMaskIndex:function(){return this.options.maskIndex},onAdd:function(a){this._layer=a,this._map=a._map},onRemove:function(){delete this._layer,delete this._map},_getProjectedPoint:function(a,b){var c=this._getTopLeft(a.options.bbox),d=this._projectPoint(c),e=this._projectPoint(b),f=Math.round(e.x-d.x),g=Math.round(e.y-d.y);return[f,g]},_getProjectedPoints:function(a,b){for(var c=this._getTopLeft(a.options.bbox),d=this._projectPoint(c),e=[],f=0;f<b.length;f++){var g=b[f],h=this._projectPoint(g),i=Math.round(h.x-d.x),j=Math.round(h.y-d.y);e.push([i,j])}return e},_getTopLeft:function(a){var b=a.getNorthWest();return[b.lng,b.lat]},_projectPoint:function(a){var b=this._map;return b.project([a[1],a[0]])},_getCoordinates:function(a){var b=g.getGeoJsonBoundingBox(a);if(!b)return null;var c=b.getCenter();return[c.lng,c.lat]}});a.exports=h},function(a,b,c){var d=c(13),e=c(3),f=c(10),g=c(9),h=e.extend({initialize:function(a){this.options=a||{},this.setData(this.options.data)},setData:function(a){this._indexData(a)},loadData:function(a){var b=this,c=b._searchInBbox(a.bbox);return g.resolve(c)},_indexData:function(a){this._rtree=d(9),a=a||[];for(var b=[],c=this,e=0;e<a.length;e++){var f=a[e],g=c._getBoundingBox(f);if(g){var h=c._toIndexKey(g);h.data=f,b.push(h)}}this._rtree.load(b)},_searchInBbox:function(a){var b=this._toIndexKey(a),c=this._rtree.search(b);c=this._sortByDistance(c,a);for(var d=[],e=0;e<c.length;e++){var f=c[e];d.push(f.data)}return d},_sortByDistance:function(a,b){var c=b.getNorth(),d=b.getEast(),e=[c,d];return a.sort(function(a,b){var c=Math.abs(a[0]-e[0])+Math.abs(a[1]-e[1]),d=Math.abs(b[0]-e[0])+Math.abs(b[1]-e[1]);return c-d}),a},_toIndexKey:function(a){var b=a.getSouthWest(),c=a.getNorthEast(),d=[b.lat,b.lng,c.lat,c.lng];return d},_getBoundingBox:f.getGeoJsonBoundingBox});a.exports=h},function(a,b,c){var d=c(1),e=c(4),f=(c(10),c(9),e.extend({initialize:function(){e.prototype.initialize.apply(this,arguments),this._markerCache={}},getBufferZoneSize:function(){var a=2.5*this._getRadius();return[a,a]},_drawFeature:function(a,b){var c=a.geometry;c&&this._drawResourceMarker(a,b)},_drawResourceMarker:function(a,b){var c=this._getCoordinates(a);if(c){var e=this._getProjectedPoint(b,c);if(e){var f,g=this._getMarkerCacheKey(a,b);if(g&&(f=this._markerCache[g]),f||(f=this._newResourceMarker(a,b),f&&f.image&&g&&(this._markerCache[g]=f,b.setImageKey(f.image))),f&&f.image){var h=d.point(f.anchor),i=d.point(e).subtract(h);b.drawImage(f.image,[i.x,i.y],{data:a})}}}},_getRadius:function(){return this.options.radius||16},_getMarkerCacheKey:function(a,b){var c=b.options.zoom,d=this._getResourceType(a),e=c+":"+d;return e},_getResourceType:function(){return"resource"},_newResourceMarker:function(a,b){var c=this._getRadius(),d=document.createElement("canvas"),e=this._getRenderingOptions(a,b),f=e.lineWidth||0,g=2*c,h=2*c;d.height=h,d.width=g,c-=f;var i=d.getContext("2d");return i.fillStyle=e.fillColor||"white",i.globalAlpha=e.fillOpacity||1,i.strokeStyle=e.lineColor||"gray",i.lineWidth=f,i.lineCap="round",this._drawMarker(i,f,f,g-2*f,h-2*f,.6*c),i.fill(),i.stroke(),{image:d,anchor:[g/2,h]}},_drawMarker:function(a,b,c,d,e,f){a.beginPath(),a.moveTo(b+d/2,c),a.bezierCurveTo(b+d/2+f/2,c,b+d/2+f,c+f/2,b+d/2+f,c+f),a.bezierCurveTo(b+d/2+f,c+2*f,b+d/2,c+e/2+f/3,b+d/2,c+e),a.bezierCurveTo(b+d/2,c+e/2+f/3,b+d/2-f,c+2*f,b+d/2-f,c+f),a.bezierCurveTo(b+d/2-f,c+f/2,b+d/2-f/2,c+0,b+d/2,c+0),a.closePath()},_getRenderingOptions:function(){return{}},_getMaskIndex:function(){return this.options.maskIndex||{}}}));a.exports=f},function(a,b,c){var d=(c(1),c(4)),e=c(9),f=d.extend({initialize:function(){d.prototype.initialize.apply(this,arguments),this._markerCache={}},getBufferZoneSize:function(){var a=32;return a=this._layer&&this._layer._map?this._layer._getTileSize()/4:32,[a,a]},_prepareContext:function(a){return e.resolve(a)},_drawFeature:function(a,b){function c(c){var d=g._getMarkerOptions(b,a);if(d.image){d.reuseMask&&b.setImageKey(d.image);for(var e=0;e<c.length;e++){var f=c[e],h=[f[0],f[1]];d.anchor&&(h[0]-=d.anchor[0],h[1]-=d.anchor[1]),b.drawImage(d.image,h,{data:a})}}}function d(c){var d=(g._getProjectedPoints(b,c),g._getLineOptions(b,a));b.drawLine(c,d),b.drawImage(d.image,d.anchor,{data:a})}function e(c){for(var d=g._getProjectedPoints(b,c[0]),e=[],f=1;f<c.length;f++){var h=g._getProjectedPoints(b,c[f]);h.length&&e.push(h)}var i=g._getPolygonOptions(b,a);b.drawPolygon(d,e,i),b.drawImage(i.image,i.anchor,{data:a})}function f(a){var h=a.coordinates;switch(a.type){case"Point":!function(){var a=g._getProjectedPoint(b,h);c([a])}();break;case"MultiPoint":!function(){var a=g._getProjectedPoints(b,h);c(a)}();break;case"LineString":!function(){var a=g._getProjectedPoints(b,h);d(a)}();break;case"MultiLineString":!function(){for(var a=0;a<h.length;a++){var c=g._getProjectedPoints(b,h[a]);d(c)}}();break;case"Polygon":!function(){e(h)}();break;case"MultiPolygon":!function(){for(var a=0;a<h.length;a++)e(h[a])}();break;case"GeometryCollection":!function(){for(var b=a.geometries,c=0,d=b.length;d>c;c++)f(b[c])}()}}var g=this,h=a.geometry;h&&f(h)},_getLineOptions:function(a,b){return{lineColor:"red",lineOpacity:1,lineWidth:.8,data:b}},_getPolygonOptions:function(a,b){return{fillOpacity:.3,fillColor:"green",lineColor:"white",lineOpacity:1,lineWidth:1,data:b}},_getMarkerOptions:function(a,b){var c,d=this,e=d._getMarkerCacheKey(b,a);return e&&(c=d._markerCache[e]),c||(c=d._newResourceMarker(b,a),c&&c.image&&e&&(d._markerCache[e]=c,c.reuseMask=!0),c.anchor&&void 0!==c.anchor.x&&(c.anchor=[c.anchor.x,c.anchor.y])),c},_getMarkerCacheKey:function(a,b){var c=b.options.zoom,d=this._getResourceType(a),e=c+":"+d;return e},_getResourceType:function(){return"resource"},_newResourceMarker:function(a,b){var c=this._getRadius(),d=b.newCanvas(),e=this._getRenderingOptions(a,b),f=e.lineWidth||0,g=2*c,h=2*c;d.height=h,d.width=g,c-=f;var i=d.getContext("2d");return i.fillStyle=e.fillColor||"white",i.globalAlpha=e.fillOpacity||1,i.strokeStyle=e.lineColor||"gray",i.lineWidth=f,i.lineCap="round",this._drawMarker(i,f,f,g-2*f,h-2*f,.6*c),i.fill(),i.stroke(),{image:d,anchor:[g/2,h]}},_drawMarker:function(a,b,c,d,e,f){a.beginPath(),a.moveTo(b+d/2,c),a.bezierCurveTo(b+d/2+f/2,c,b+d/2+f,c+f/2,b+d/2+f,c+f),a.bezierCurveTo(b+d/2+f,c+2*f,b+d/2,c+e/2+f/3,b+d/2,c+e),a.bezierCurveTo(b+d/2,c+e/2+f/3,b+d/2-f,c+2*f,b+d/2-f,c+f),a.bezierCurveTo(b+d/2-f,c+f/2,b+d/2-f/2,c+0,b+d/2,c+0),a.closePath()},_getRenderingOptions:function(){return{}},_getMaskIndex:function(){return this.options.maskIndex||{}}});a.exports=f},function(a,b,c){function d(){e.apply(this,arguments)}var e=c(11);e.extend(d,e),d.extend(d.prototype,e.prototype),d.extend(d.prototype,{initialize:function(){e.prototype.initialize.apply(this,arguments),this._canvas=this.options.canvas,this._canvasContext=this._canvas.getContext("2d");var a=this.options.resolution||4;this.options.resolutionX=this.options.resolutionX||a,this.options.resolutionY=this.options.resolutionY||this.options.resolutionX||a,this._maskWidth=this._getMaskX(this._canvas.width),this._maskHeight=this._getMaskY(this._canvas.height),this._dataIndex={}},getCanvasSize:function(){return[this._canvas.width,this._canvas.height]},drawImage:function(a,b,c){if(a&&b){var d=b[0],e=b[1];this._canvasContext.drawImage(a,d,e);var f=c&&c.data;this._addToCanvasMask(a,d,e,f)}},getData:function(a,b){var c=this._getMaskX(a),d=this._getMaskY(b),e=d*this._maskWidth+c,f=this._dataIndex[e];return f},reset:function(){var a=this._canvasContext;a.clearRect(0,0,this._canvas.width,this._canvas.height),this._dataIndex={}},_addToCanvasMask:function(a,b,c,d){var e=!1;if(!d)return e;for(var f=this._getImageMask(a),g=this._getMaskX(a.width),h=this._getMaskX(b),i=this._getMaskY(c),j=0;j<f.length;j++)if(f[j]){var k=h+j%g,l=i+Math.floor(j/g);k>=0&&k<this._maskWidth&&l>=0&&l<this._maskHeight&&(this._dataIndex[l*this._maskWidth+k]=d,e=!0)}return e},_getImageMask:function(a){var b=this._getImageMaskIndex(),c=this.getImageKey(a);if(!b||!c)return this._buildImageMask(a);var d=b[c];return d||(d=this._buildImageMask(a),b[c]=d),d},getImageKey:function(a){var b=a["image-id"];return b},setImageKey:function(a,b){var c=a["image-id"];if(!c){if(!b){var e=d._imageIdCounter||0;d._imageIdCounter=e+1,b="key-"+e}c=a["image-id"]=b}return c},_getImageMaskIndex:function(){return this.options.maskIndex},_buildImageMask:function(a){var b=this.newCanvas(),c=b.getContext("2d"),d=this._getMaskX(a.width),e=this._getMaskY(a.height);b.width=d,b.height=e,c.drawImage(a,0,0,d,e);for(var f=c.getImageData(0,0,d,e).data,g=new Array(d*e),h=0;e>h;h++)for(var i=0;d>i;i++){var j=h*d+i,k=this._checkFilledPixel(f,j);g[j]=k?1:0}return g},_checkFilledPixel:function(a,b){var c=4*b+3;return!!a[c]},_getMaskX:function(a){var b=this.options.resolutionX;return Math.round(a/b)},_getMaskY:function(a){var b=this.options.resolutionY;return Math.round(a/b)}}),a.exports=d},function(a,b,c){function d(a){return d.resolve(a)}a.exports=d,d.defer=d.deferred=function(){var a=c(12);return d.defer=a,d.defer()},d.then=function(a,b){var c=d.defer();return c.resolve(),c.promise.then(a,b)},d.reject=d.rejected=function(a){var b=d.defer();return b.reject(a),b.promise},d.resolve=d.resolved=function(a){var b=d.defer();return b.resolve(a),b.promise},d.isPromise=function(a){return a&&"function"==typeof a.then},d._isArray=function(a){return d._isArray=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},d._isArray(a)},d.all=function(a){function b(a,b){h.push(b),a?f.reject(a):h.length===g&&f.resolve(h)}function c(a){b(null,a)}function e(a){b(a,null)}var f=d.defer();a=d._isArray(a)?a:arguments;for(var g=a?a.length:0,h=[],i=0;g>i;i++)a[i].then(c,e);return 0===g&&f.resolve(h),f.promise},d.nresolver=function(a){return function(b,c){b?a.reject(b):a.resolve(c)}},d.ninvoke=function(a,b){for(var c=[],e=2;e<arguments.length;e++)c.push(arguments[e]);var f=d.defer();c.push(d.nresolver(f));try{var g="function"==typeof b?b:a[b];g.apply(a,c)}catch(h){f.reject(h)}return f.promise}},function(a,b,c){var d=c(1);a.exports={forEach:function(a,b){if(a.forEach)a.forEach(b);else for(var c=a?a.length:0,d=0;c>d;d++)b(a[d],d)},extend:function(){var a=arguments[0];if(a)for(var b=1;b<arguments.length;b++){var c=arguments[b];if(c)for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])}return a},getGeoJsonBoundingBox:function(a){if(!a)return null;var b=a.geometry;if(!b||!b.coordinates)return null;var c;if("Point"==b.type){var e=b.coordinates,f=d.latLng(e[1],e[0]);c=d.latLngBounds(f,f)}else{var g=d.GeoJSON.geometryToLayer(b);c=g.getBounds()}return c}}},function(a){function b(){this.initialize.apply(this,arguments)}b.extend=function(a){for(var b=arguments.length,c=1;b>c;c++){var d=arguments[c];for(var e in d)a[e]=d[e]}},b.extend(b.prototype,{initialize:function(a){this.options=a||{},this.options.width||(this.options.width=256),this.options.height||(this.options.height=256)},drawImage:function(a,b,c){var d=this.options.context;d.draw(a,b[0],b[1],c.data)},drawLine:function(a,b){var c=this._getStrokeStyles(b);if(c){var d=this._getTmpCanvasContext(),e=d.canvas;a=this._simplify(a);var f=this._drawLines(d,a,c);f&&this.drawImage(e,[0,0],b)}},drawPolygon:function(a,b,c){var d=this._getFillStyles(c),e=this._getStrokeStyles(c);if(d||e){var f,g=this._getTmpCanvasContext(),h=g.canvas;for(a=this._simplify(a),b=b||[],f=0;f<b.length;f++)b[f]=this._simplify(b[f]);var i=!1;for(i|=this._drawPolygons(g,a,b,d),i|=this._drawLines(g,a,e),f=0;f<b.length;f++)i|=this._drawLines(g,b[f],e);i&&this.drawImage(h,[0,0],c)}},getCanvasSize:function(){return[this.options.width,this.options.height]},newCanvas:function(){var a;a=this.options.newCanvas?this.options.newCanvas():document.createElement("canvas");var b=this.getCanvasSize();return a.width=b[0],a.height=b[1],a},_getTmpCanvasContext:function(){var a=this._getTmpCanvas(),b=a._context;return b||(b=a._context=a.getContext("2d"),b.canvas=a),b},_getTmpCanvas:function(){return this.newCanvas()},_getBoundingPolygon:function(a){var b=this._getBoundingBox(a),c=b[0],d=b[1];return[[c[0],c[1]],[d[0],c[1]],[d[0],d[1]],[c[0],d[1]]]},_getBoundingBox:function(a){a=a||[0,0];var b=this.getCanvasSize();return[[-a[0],-a[1]],[b[0]+a[0],b[1]+a[1]]]},_getBufferZone:function(){return[10,10]},_drawPolygons:function(a,c,d,e){if(!e)return!1;var f,g=this._getBufferZone(),h=this._getBoundingPolygon(g),i=c?b.clipPolygon(c,h):[],j=[],k=d?d.length:0;for(f=0;k>f;f++){var l=b.clipPolygon(d[f],h);l.length&&j.push(l)}for(a.globalCompositeOperation="source-over",this._setCanvasStyles(a,e),e._pattern&&(a.fillStyle=a.createPattern(e._pattern,"repeat")),this._trace(a,i,!0),a.fill(),a.globalCompositeOperation="destination-out",a.globalAlpha=1,f=0;f<j.length;f++)j[f].length&&(this._trace(a,j[f],!0),a.fill());return!0},_drawLines:function(a,c,d){if(!d)return!1;var e=this._getBufferZone(),f=this._getBoundingBox(e),g=b.clipLines(c,f)||[];if(!g.length)return!1;a.globalCompositeOperation="source-over",this._setCanvasStyles(a,d),a.beginPath();for(var h=0;h<g.length;h++)this._trace(a,g[h],!1),a.stroke();return!0},_trace:function(a,b,c){if(b&&b.length){a.beginPath(),a.moveTo(b[0][0],b[0][1]);for(var d=1;d<b.length;d++)a.lineTo(b[d][0],b[d][1]);c&&a.closePath()}},_simplify:function(a){var c=this.options.tolerance||.5,d=!!this.options.highQuality,e=b.simplify(a,c,d);return e},_getFillStyles:function(a){var b={};return b.fillStyle=a.fillColor||a.color||"blue",b.globalAlpha=a.fillOpacity||a.opacity||0,a.fillImage&&(b._pattern=a.fillImage),this._isEmptyValue(b.globalAlpha)&&!b._pattern?null:b},_getStrokeStyles:function(a){var b={};return b.strokeStyle=a.lineColor||a.color||"blue",b.globalAlpha=a.lineOpacity||a.opacity||0,b.lineWidth=a.lineWidth||a.width||0,b.lineCap=a.lineCap||"round",b.lineJoin=a.lineJoin||"round",this._isEmptyValue(b.lineWidth)||this._isEmptyValue(b.globalAlpha)?null:b},_isEmptyValue:function(a){return void 0===a||0===a||""===a},_setCanvasStyles:function(a,b){for(var c in b)c&&"_"!==c[0]&&(a[c]=b[c])}}),b.extend(b,{clipLines:function(a,b){for(var c=[],d=a[0],e=1;e<a.length;e++){var f=a[e],g=this.clipLine([d,f],b);g&&c.push(g),d=f}return c},clipLine:function(){function a(a,b,c,d,e,f){var g=0;return b>f?g|=1:d>b&&(g|=2),a>e?g|=4:c>a&&(g|=8),g}return function(b,c){var d=b[0][0],e=b[0][1],f=b[1][0],g=b[1][1],h=Math.min(c[0][0],c[1][0]),i=Math.min(c[0][1],c[1][1]),j=Math.max(c[0][0],c[1][0]),k=Math.max(c[0][1],c[1][1]),l=!1,m=!1,n=a(d,e,h,i,j,k),o=a(f,g,h,i,j,k);do if(0===n&&0===o)l=!0,m=!0;else if(n&o)m=!0;else{var p,q,r=n?n:o;1&r?(p=d+(f-d)*(k-e)/(g-e),q=k):2&r?(p=d+(f-d)*(i-e)/(g-e),q=i):4&r?(q=e+(g-e)*(j-d)/(f-d),p=j):(q=e+(g-e)*(h-d)/(f-d),p=h),r===n?(d=p,e=q,n=a(d,e,h,i,j,k)):(f=p,g=q,o=a(f,g,h,i,j,k))}while(!m);var s=[[d,e],[f,g]];return l?s:null}}(),clipPolygon:function(a,b){var c,d,e,f,g=function(a){return(d[0]-c[0])*(a[1]-c[1])>(d[1]-c[1])*(a[0]-c[0])},h=function(){var a=[c[0]-d[0],c[1]-d[1]],b=[e[0]-f[0],e[1]-f[1]],g=c[0]*d[1]-c[1]*d[0],h=e[0]*f[1]-e[1]*f[0],i=1/(a[0]*b[1]-a[1]*b[0]);return[Math.round((g*b[0]-h*a[0])*i),Math.round((g*b[1]-h*a[1])*i)]},i=a;c=b[b.length-1];for(var j in b){d=b[j];var k=i;i=[],e=k[k.length-1];for(var l in k)f=k[l],g(f)?(g(e)||i.push(h()),i.push(f)):g(e)&&i.push(h()),e=f;c=d}return i&&i.length&&i.push(i[0]),i||[]},simplify:function(){function a(a,b){var c=a[0]-b[0],d=a[1]-b[1];return c*c+d*d}function b(a,b,c){var d=b[0],e=b[1],f=c[0]-d,g=c[1]-e;if(0!==f||0!==g){var h=((a[0]-d)*f+(a[1]-e)*g)/(f*f+g*g);h>1?(d=c[0],e=c[1]):h>0&&(d+=f*h,e+=g*h)}return f=a[0]-d,g=a[1]-e,f*f+g*g}function c(b,c){for(var d,e=b[0],f=[e],g=1,h=b.length;h>g;g++)d=b[g],a(d,e)>c&&(f.push(d),e=d);return e!==d&&f.push(d),f}function d(a,c){var d,e,f,g,h=a.length,i="undefined"!=typeof Uint8Array?Uint8Array:Array,j=new i(h),k=0,l=h-1,m=[],n=[];for(j[k]=j[l]=1;l;){for(e=0,d=k+1;l>d;d++)f=b(a[d],a[k],a[l]),f>e&&(g=d,e=f);e>c&&(j[g]=1,m.push(k,g,g,l)),l=m.pop(),k=m.pop()}for(d=0;h>d;d++)j[d]&&n.push(a[d]);return n}function e(a,b,e){if(a.length<=1)return a;var f=void 0!==b?b*b:1;return a=e?a:c(a,f),a=d(a,f)}return e}()}),a.exports=b},function(a){function b(){function a(a){f=g=function(){};var h=!1;(d=function(){h||(h=!0,b.nextTick(function(){h=!1;var b=e;e=[];for(var d=0;d<b.length;d++){var f=b[d],g=f.next;try{if(result=a(f),result===g)throw new TypeError("Can not resolve promise with itself");var i=result?result.then:null;c(i)?i.call(result,g.resolve,g.reject):g.resolve.call(null,result)}catch(j){g.reject.call(null,j)}}}))})()}function c(a){return"function"==typeof a}var d,e=[],f=function(b){a(function(a){return c(a.onResolve)?a.onResolve.call(void 0,b):b})},g=function(b){a(function(a){if(c(a.onReject))return a.onReject.call(void 0,b);throw b})};return{promise:{then:function(a,c){var f=b();return e.push({onResolve:a,onReject:c,next:f}),d&&d(),f.promise}},resolve:function(a){f(a)},reject:function(a){g(a)}}}a.exports=b,b.SYNC=!1,b.runSync=function(){return b.SYNC},b.nextTick=function(a){b.runSync()?a():setTimeout(a,0)}},function(a,b,c){var d;!function(){"use strict";function e(a,b){return this instanceof e?(this._maxEntries=Math.max(4,a||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),b&&this._initFormat(b),void this.clear()):new e(a,b)}function f(a,b){a.bbox=g(a,0,a.children.length,b)}function g(a,b,c,d){for(var e,f=h(),g=b;c>g;g++)e=a.children[g],i(f,a.leaf?d(e):e.bbox);return f}function h(){return[1/0,1/0,-1/0,-1/0]}function i(a,b){return a[0]=Math.min(a[0],b[0]),a[1]=Math.min(a[1],b[1]),a[2]=Math.max(a[2],b[2]),a[3]=Math.max(a[3],b[3]),a}function j(a,b){return a.bbox[0]-b.bbox[0]}function k(a,b){return a.bbox[1]-b.bbox[1]}function l(a){return(a[2]-a[0])*(a[3]-a[1])}function m(a){return a[2]-a[0]+(a[3]-a[1])}function n(a,b){return(Math.max(b[2],a[2])-Math.min(b[0],a[0]))*(Math.max(b[3],a[3])-Math.min(b[1],a[1]))}function o(a,b){var c=Math.max(a[0],b[0]),d=Math.max(a[1],b[1]),e=Math.min(a[2],b[2]),f=Math.min(a[3],b[3]);return Math.max(0,e-c)*Math.max(0,f-d)}function p(a,b){return a[0]<=b[0]&&a[1]<=b[1]&&b[2]<=a[2]&&b[3]<=a[3]}function q(a,b){return b[0]<=a[2]&&b[1]<=a[3]&&b[2]>=a[0]&&b[3]>=a[1]}function r(a,b,c,d,e){for(var f,g=[b,c];g.length;)c=g.pop(),b=g.pop(),d>=c-b||(f=b+Math.ceil((c-b)/d/2)*d,s(a,b,c,f,e),g.push(b,f,f,c))}function s(a,b,c,d,e){for(var f,g,h,i,j,k,l,m,n;c>b;){for(c-b>600&&(f=c-b+1,g=d-b+1,h=Math.log(f),i=.5*Math.exp(2*h/3),j=.5*Math.sqrt(h*i*(f-i)/f)*(0>g-f/2?-1:1),k=Math.max(b,Math.floor(d-g*i/f+j)),l=Math.min(c,Math.floor(d+(f-g)*i/f+j)),s(a,k,l,d,e)),m=a[d],g=b,n=c,t(a,b,d),e(a[c],m)>0&&t(a,b,c);n>g;){for(t(a,g,n),g++,n--;e(a[g],m)<0;)g++;for(;e(a[n],m)>0;)n--}0===e(a[b],m)?t(a,b,n):(n++,t(a,n,c)),d>=n&&(b=n+1),n>=d&&(c=n-1)}}function t(a,b,c){var d=a[b];a[b]=a[c],a[c]=d}e.prototype={all:function(){return this._all(this.data,[])},search:function(a){var b=this.data,c=[],d=this.toBBox;if(!q(a,b.bbox))return c;for(var e,f,g,h,i=[];b;){for(e=0,f=b.children.length;f>e;e++)g=b.children[e],h=b.leaf?d(g):g.bbox,q(a,h)&&(b.leaf?c.push(g):p(a,h)?this._all(g,c):i.push(g));b=i.pop()}return c},load:function(a){if(!a||!a.length)return this;if(a.length<this._minEntries){for(var b=0,c=a.length;c>b;b++)this.insert(a[b]);return this}var d=this._build(a.slice(),0,a.length-1,0);if(this.data.children.length)if(this.data.height===d.height)this._splitRoot(this.data,d);else{if(this.data.height<d.height){var e=this.data;this.data=d,d=e}this._insert(d,this.data.height-d.height-1,!0)}else this.data=d;return this},insert:function(a){return a&&this._insert(a,this.data.height-1),this},clear:function(){return this.data={children:[],height:1,bbox:h(),leaf:!0},this},remove:function(a){if(!a)return this;for(var b,c,d,e,f=this.data,g=this.toBBox(a),h=[],i=[];f||h.length;){if(f||(f=h.pop(),c=h[h.length-1],b=i.pop(),e=!0),f.leaf&&(d=f.children.indexOf(a),-1!==d))return f.children.splice(d,1),h.push(f),this._condense(h),this;e||f.leaf||!p(f.bbox,g)?c?(b++,f=c.children[b],e=!1):f=null:(h.push(f),i.push(b),b=0,c=f,f=f.children[0])}return this},toBBox:function(a){return a},compareMinX:function(a,b){return a[0]-b[0]},compareMinY:function(a,b){return a[1]-b[1]},toJSON:function(){return this.data},fromJSON:function(a){return this.data=a,this},_all:function(a,b){for(var c=[];a;)a.leaf?b.push.apply(b,a.children):c.push.apply(c,a.children),a=c.pop();return b},_build:function(a,b,c,d){var e,g=c-b+1,h=this._maxEntries;if(h>=g)return e={children:a.slice(b,c+1),height:1,bbox:null,leaf:!0},f(e,this.toBBox),e;d||(d=Math.ceil(Math.log(g)/Math.log(h)),h=Math.ceil(g/Math.pow(h,d-1))),e={children:[],height:d,bbox:null};var i,j,k,l,m=Math.ceil(g/h),n=m*Math.ceil(Math.sqrt(h));for(r(a,b,c,n,this.compareMinX),i=b;c>=i;i+=n)for(k=Math.min(i+n-1,c),r(a,i,k,m,this.compareMinY),j=i;k>=j;j+=m)l=Math.min(j+m-1,k),e.children.push(this._build(a,j,l,d-1));return f(e,this.toBBox),e},_chooseSubtree:function(a,b,c,d){for(var e,f,g,h,i,j,k,m;;){if(d.push(b),b.leaf||d.length-1===c)break;for(k=m=1/0,e=0,f=b.children.length;f>e;e++)g=b.children[e],i=l(g.bbox),j=n(a,g.bbox)-i,m>j?(m=j,k=k>i?i:k,h=g):j===m&&k>i&&(k=i,h=g);b=h}return b},_insert:function(a,b,c){var d=this.toBBox,e=c?a.bbox:d(a),f=[],g=this._chooseSubtree(e,this.data,b,f);for(g.children.push(a),i(g.bbox,e);b>=0&&f[b].children.length>this._maxEntries;)this._split(f,b),b--;this._adjustParentBBoxes(e,f,b)},_split:function(a,b){var c=a[b],d=c.children.length,e=this._minEntries;this._chooseSplitAxis(c,e,d);var g={children:c.children.splice(this._chooseSplitIndex(c,e,d)),height:c.height};c.leaf&&(g.leaf=!0),f(c,this.toBBox),f(g,this.toBBox),b?a[b-1].children.push(g):this._splitRoot(c,g)},_splitRoot:function(a,b){this.data={children:[a,b],height:a.height+1},f(this.data,this.toBBox)},_chooseSplitIndex:function(a,b,c){var d,e,f,h,i,j,k,m;for(j=k=1/0,d=b;c-b>=d;d++)e=g(a,0,d,this.toBBox),f=g(a,d,c,this.toBBox),h=o(e,f),i=l(e)+l(f),j>h?(j=h,m=d,k=k>i?i:k):h===j&&k>i&&(k=i,m=d);return m},_chooseSplitAxis:function(a,b,c){var d=a.leaf?this.compareMinX:j,e=a.leaf?this.compareMinY:k,f=this._allDistMargin(a,b,c,d),g=this._allDistMargin(a,b,c,e);g>f&&a.children.sort(d)},_allDistMargin:function(a,b,c,d){a.children.sort(d);var e,f,h=this.toBBox,j=g(a,0,b,h),k=g(a,c-b,c,h),l=m(j)+m(k);for(e=b;c-b>e;e++)f=a.children[e],i(j,a.leaf?h(f):f.bbox),l+=m(j);for(e=c-b-1;e>=b;e--)f=a.children[e],i(k,a.leaf?h(f):f.bbox),l+=m(k);return l},_adjustParentBBoxes:function(a,b,c){for(var d=c;d>=0;d--)i(b[d].bbox,a)},_condense:function(a){for(var b,c=a.length-1;c>=0;c--)0===a[c].children.length?c>0?(b=a[c-1].children,b.splice(b.indexOf(a[c]),1)):this.clear():f(a[c],this.toBBox)},_initFormat:function(a){var b=["return a"," - b",";"];this.compareMinX=new Function("a","b",b.join(a[0])),this.compareMinY=new Function("a","b",b.join(a[1])),this.toBBox=new Function("a","return [a"+a.join(", a")+"];")}},d=function(){return e}.call(b,c,b,a),!(void 0!==d&&(a.exports=d))}()}])});